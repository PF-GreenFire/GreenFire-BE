<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
    <mapper namespace="sisosolsol.greenfire.store.model.dao.StoreMapper">
        <resultMap id="storeListResultMap" type="sisosolsol.greenfire.store.model.dto.StoreListDTO">
            <id property="storeCode" column="store_code"/>
            <result property="createdAt" column="created_at"/>
            <result property="storeName" column="store_name"/>
            <result property="storeStatus" column="store_status"/>
            <result property="storeFoodType" column="store_food_type"/>
            <result property="storeCategoryName" column="store_category_name"/>
            <result property="path" column="path"/>
            <result property="fileName" column="file_name"/>
        </resultMap>
        <resultMap id="applyStoreListResultMap" type="sisosolsol.greenfire.store.model.dto.ApplyStoreListDTO">
            <id property="storeCode" column="store_code"/>
            <result property="createdAt" column="created_at"/>
            <result property="storeName" column="store_name"/>
            <result property="storeStatus" column="store_status"/>
            <result property="areaName" column="area_name"/>
        </resultMap>

        <!--  초록불 장소 목록 조회 TODO: 현재 위치 정보를 기반으로 반경 지도 목록을 보여주는 것으로 수정 예정 -->
        <select id="findStoreList" resultMap="storeListResultMap">
            SELECT
                s.store_code,
                s.created_at,
                s.store_name,
                s.store_status,
                s.store_food_type,
                c.store_category_name,
                i.path,
                i.file_name
            FROM
                tbl_store s
            LEFT JOIN
                tbl_store_category c ON s.store_category_code = c.store_category_code
            LEFT JOIN
                tbl_image i ON i.store_code = s.store_code
            WHERE
                s.store_status = 'APPROVE'
        </select>

        <!-- 관리자 초록불 장소 상태에 따른 목록 페이징 조회를 위한 토탈 갯수 조회 -->
        <select id="countStoresByStoreStatus" resultType="int">
            SELECT COUNT(*)
            FROM tbl_store
            WHERE store_status = #{storeStatus}
        </select>

        <!-- 관리자 초록불 장소 상태에 따른 목록 페이징 조회 [신청 대기, 신청 승인] -->
        <select id="findStoreListByStoreStatus" resultMap="applyStoreListResultMap" parameterType="sisosolsol.greenfire.common.page.SelectCriteria">
            SELECT
                s.store_code,
                s.created_at,
                s.store_name,
                s.store_status,
                a.area_name
            FROM
                tbl_store s
            LEFT JOIN
                tbl_location l ON s.location_code = l.location_code
            LEFT JOIN
                tbl_area a ON l.area_code = a.area_code
            WHERE
                s.store_status = #{storeStatus}
            ORDER BY
                s.created_at DESC
            LIMIT #{criteria.limit} OFFSET #{criteria.offset}
        </select>
</mapper>